<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç¸¦å‹5:4ãƒ•ã‚©ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ã‚«ãƒ¡ãƒ©</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<div id="camera-container">
  <video id="camera" autoplay playsinline></video>
  <img id="frame" alt="ãƒ•ã‚©ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ">
  <canvas id="canvas"></canvas>

  <div id="buttons">
    <button id="start-camera">ğŸ“· ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•</button>
    <button id="capture-button">ğŸ“¸ æ’®å½±</button>
  </div>

  <div id="share-area">
    <p>#ãªã”ã‚„å»ºç¯‰ã¾ã¤ã‚Š2025</p>
    <button id="instagram-button">Instagramã§æŠ•ç¨¿</button>
  </div>
</div>

<script>
const video = document.getElementById('camera');
const canvas = document.getElementById('canvas');
const frame = document.getElementById('frame');
const startButton = document.getElementById('start-camera');
const captureButton = document.getElementById('capture-button');
const shareArea = document.getElementById('share-area');
const instagramButton = document.getElementById('instagram-button');

// URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‹ã‚‰ãƒ•ãƒ¬ãƒ¼ãƒ ç•ªå·ã‚’å–å¾—
const urlParams = new URLSearchParams(window.location.search);
let frameNum = urlParams.get('frame') || '01'; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯01
frame.src = `frames/frame${String(frameNum).padStart(2,'0')}.png`;

// åˆæœŸè¡¨ç¤ºã¯éè¡¨ç¤º
video.style.display = 'none';
frame.style.display = 'none';
canvas.style.display = 'none';
captureButton.style.display = 'none';
shareArea.style.display = 'none';

// ã‚«ãƒ¡ãƒ©èµ·å‹•
startButton.addEventListener('click', async () => {
  try {
    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
    video.srcObject = stream;
    video.style.display = 'block';
    frame.style.display = 'block';
    captureButton.style.display = 'inline-block';
    startButton.style.display = 'none';
  } catch(err) {
    alert("ã‚«ãƒ¡ãƒ©ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“: " + err);
  }
});

// æ’®å½±
captureButton.addEventListener('click', () => {
  const frameAspect = 5 / 4;
  const height = video.videoHeight;
  const width = height / frameAspect;

  canvas.width = width;
  canvas.height = height;
  const ctx = canvas.getContext('2d');

  const sx = (video.videoWidth - width) / 2;
  ctx.drawImage(video, sx, 0, width, height);
  ctx.drawImage(frame, 0, 0, width, height);

  // è‡ªå‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
  const link = document.createElement('a');
  link.download = `photo_frame.png`;
  link.href = canvas.toDataURL('image/png');
  link.click();

  // SNSå…±æœ‰ãƒœã‚¿ãƒ³è¡¨ç¤º
  shareArea.style.display = 'block';
});

// InstagramæŠ•ç¨¿èª˜å°
instagramButton.addEventListener('click', () => {
  const hashtag = "ãªã”ã‚„å»ºç¯‰ã¾ã¤ã‚Š2025";
  const url = `https://www.instagram.com/explore/tags/${encodeURIComponent(hashtag)}/`;
  window.open(url, "_blank");
});
</script>

</body>
</html>
